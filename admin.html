<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Shoe Store Management</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">


    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f8f9fa;
        }

        #navbar {
            display: flex;
            justify-content: space-around;
            align-items: center;
            background-color: #ffffff;
            padding: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .nav-link {
            color: #333;
            transition: color 0.2s;
            padding: 10px;
        }

        .nav-link:hover {
            color: #007bff;
        }

        .nav-link.active {
            font-weight: bold;
            color: #007bff;
        }

        .btn-toolbar .btn-group .btn {
            margin-right: 0.5rem;
        }

        .card {
            border-radius: 0.5rem;
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: bold;
        }

        main {
            background-color: #fff;
            padding: 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .border-bottom {
            border-bottom: 2px solid #e9ecef !important;
        }

        .overview-card {
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 20px;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .overview-card .card-icon {
            font-size: 1.5rem;
            color: #007bff;
            margin-bottom: 10px;
        }

        #dashboard .overview-card-wrapper {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
        }
    </style>
</head>
<body>

<div class="container-fluid">
    <!-- Navbar -->
    <nav id="navbar">
        <a class="nav-link active" href="#dashboard" onclick="showSection('dashboard')">
            <i class="fa fa-home"></i> Dashboard
        </a>
        <a class="nav-link" href="#manage-products" onclick="showSection('manage-products')">
            <i class="fa fa-shopping-cart"></i> Manage Products
        </a>
        <a class="nav-link" href="#manage-customers" onclick="showSection('manage-customers')">
            <i class="fa fa-users"></i> Manage Customers
        </a>
        <a class="nav-link" href="#manage-orders" onclick="showSection('manage-orders')">
            <i class="fa fa-file-text"></i> Manage Orders
        </a>
        <a class="nav-link" href="#manage-discounts" onclick="showSection('manage-discounts')">
            <i class="fa fa-tags"></i> Manage Discounts
        </a>
        <a class="nav-link" href="#manage-dot" onclick="showSection('manage-dot')">
            <i class="fa fa-tags"></i> Manage Đợt Giảm Giá
        </a>
        <a class="nav-link" href="#reports" onclick="showSection('reports')">
            <i class="fa fa-bar-chart"></i> Reports
        </a>
        <button class="btn btn-outline-primary" onclick="window.location.href='/'">Back to Homepage</button>
        <button class="btn btn-outline-danger" onclick="window.location.href='/logout'">Logout</button>
    </nav>

    <!-- Main Content -->
    <main class="col-md-12 px-md-4">
        <div id="dashboard" class="content-section">

            <h4 th:text="'Hi ' + ${userName}">Hi Admin</h4>
            <p>Email: <span th:text="${userEmail}">user@example.com</span></p>

            <div class="overview-card-wrapper">
                <div class="overview-card">
                    <div class="card-icon">
                        <i class="fa fa-cube text-primary"></i>
                    </div>
                    <h5>Total Products</h5>
                    <p>150</p>
                </div>
                <div class="overview-card">
                    <div class="card-icon">
                        <i class="fa fa-shopping-cart text-success"></i>
                    </div>
                    <h5>Total Orders</h5>
                    <p>320</p>
                </div>
                <div class="overview-card">
                    <div class="card-icon">
                        <i class="fa fa-exclamation-circle text-warning"></i>
                    </div>
                    <h5>Pending Orders</h5>
                    <p>45</p>
                </div>
                <div class="overview-card">
                    <div class="card-icon">
                        <i class="fa fa-users text-danger"></i>
                    </div>
                    <h5>Total Customers</h5>
                    <p>200</p>
                </div>
            </div>
        </div>

        <!-- Manage Products Section -->
        <div id="manage-products" class="content-section" style="display: none;">
            <h2>Manage Products</h2>
            <!-- Content for managing products -->
            <div id="manage-products-content">
                <table id="productsTable" class="table table-bordered table-striped">
                    <thead>
                    <tr>
                        <th>Product ID</th>
                        <th>Product Name</th>
                        <th>Price</th>
                        <th>Stock</th>
                    </tr>
                    </thead>
                    <tbody>
                    <!-- Data will be inserted here using JavaScript -->
                    </tbody>
                </table>
            </div>


        </div>

        <!-- Manage Customers Section -->
        <div id="manage-customers" class="content-section" style="display: none;">
            <h2>Manage Customers</h2>
            <!-- Content for managing customers -->
        </div>

        <!-- Manage Orders Section -->
        <div id="manage-orders" class="content-section" style="display: none;">
            <h2>Manage Orders</h2>
            <!-- Content for managing orders -->
        </div>

        <!-- Manage Discounts Section -->
        <div id="manage-discounts" class="content-section" style="display: none;">
            <h2>Manage Discounts</h2>
            <!-- Content for managing discounts -->
            <ul class="nav nav-tabs" id="myTab" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" id="danh-sach-phieu-giam-tab" data-toggle="tab"
                       href="#danh-sach-phieu-giam" role="tab" aria-controls="danh-sach-phieu-giam"
                       aria-selected="true">Danh Sách Phiếu Giảm</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="chinh-sua-phieu-giam-tab" data-toggle="tab" href="#chinh-sua-phieu-giam"
                       role="tab" aria-controls="chinh-sua-phieu-giam" aria-selected="false">Chỉnh Sửa Phiếu Giam</a>
                </li>
            </ul>

            <div class="tab-content" id="myTabContent">
                <!-- Danh Sách Phiếu Giảm -->
                <div class="tab-pane fade show active" id="danh-sach-phieu-giam" role="tabpanel"
                     aria-labelledby="danh-sach-phieu-giam-tab">
                    <table class="table table-hover">
                        <thead>
                        <tr>
                            <th>ID</th>
                            <th>Mã Giảm</th>
                            <th>Giá Trị Giảm Max</th>
                            <th>Giá Trị Giảm</th>
                            <th>Số Lượng</th>
                            <th>Ngày Bắt Đầu</th>
                            <th>Ngày Kết Thúc</th>
                            <th>Người Tạo</th>
                            <th>Ngày Tạo</th>
                            <th>Người Cập Nhật</th>
                            <th>Lần Cuối Cập Nhật</th>
                            <th>Trạng Thái</th>
                            <th colspan="3">Hành Động</th>
                        </tr>
                        </thead>
                        <tbody id="listPhieuGiam">

                        </tbody>
                    </table>
                </div>

                <div class="tab-pane fade" id="chinh-sua-phieu-giam" role="tabpanel"
                     aria-labelledby="chinh-sua-phieu-giam-tab">
                    <form id="yourFormId"> <!-- Thêm ID ở đây -->
                        <div class="form-group">
                            <label for="id">ID</label>
                            <input type="text" class="form-control" id="id" name="id" placeholder="Nhập ID" required
                                   disabled>
                        </div>
                        <div class="form-group">
                            <label for="maGiam">Mã Giảm Giá</label>
                            <input type="text" class="form-control" id="maGiam" name="maGiam" placeholder="Nhập mã giảm"
                                   required>
                        </div>
                        <div class="form-group">
                            <label for="giaTriGiamMax">Giá Trị Giảm Max</label>
                            <input type="number" class="form-control" id="giaTriGiamMax" name="giaTriGiamMax"
                                   placeholder="Nhập giá trị giảm max" required>
                        </div>
                        <div class="form-group">
                            <label for="giaTriGiam">Giá Trị Giảm</label>
                            <input type="number" class="form-control" id="giaTriGiam" name="giaTriGiam"
                                   placeholder="Nhập giá trị giảm" required>
                        </div>
                        <div class="form-group">
                            <label for="soLuong">Số Lượng</label>
                            <input type="number" class="form-control" id="soLuong" name="soLuong"
                                   placeholder="Nhập số lượng" required>
                        </div>
                        <div class="form-group">
                            <label for="ngayBatDau">Ngày Bắt Đầu</label>
                            <input type="date" class="form-control" id="ngayBatDau" name="ngayBatDau"
                                   placeholder="Nhập ngày bắt đầu" required>
                        </div>
                        <div class="form-group">
                            <label for="ngayKetThuc">Ngày Kết Thúc</label>
                            <input type="date" class="form-control" id="ngayKetThuc" name="ngayKetThuc"
                                   placeholder="Nhập ngày kết thúc" required>
                        </div>
                        <div class="form-group">
                            <label for="trangThai">Trạng thái</label>
                            <select class="form-select" id="trangThai" name="trangThai" required>
                                <option value="" disabled selected>Chọn trạng thái</option>
                                <option value="1">Đang hoạt động</option>
                                <option value="2">Không hoạt động</option>
                                <option value="3">Sắp đến</option>
                                <option value="4">Sắp kết thúc</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-success" id="btnThemPhieuGiam">Thêm</button>
                        <button type="submit" class="btn btn-success" id="btnLuuPhieuGiam">Lưu</button>
                        <button type="reset" class="btn btn-secondary">Reset</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Manage Dot Section -->
        <div id="manage-dot" class="content-section" style="display: none;">
            <h2>Manage Đợt giảm giá</h2>
            <!-- Content for managing discounts -->
            <ul class="nav nav-tabs" id="myTab" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" id="danh-sach-dot-giam-gia-tab" data-toggle="tab"
                       href="#danh-sach-dot-giam-gia" role="tab" aria-controls="danh-sach-dot-giam-gia"
                       aria-selected="true">Danh Sách Đợt Giảm Giá</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="chinh-sua-dot-giam-gia-tab" data-toggle="tab" href="#chinh-sua-dot-giam-gia"
                       role="tab" aria-controls="chinh-sua-dot-giam-gia" aria-selected="false">Chỉnh Sửa Đợt Giảm Giá</a>
                </li>
            </ul>

            <div class="tab-content" id="myTabContent">
                <!-- Danh Sách Phiếu Giảm -->
                <div class="tab-pane fade show active" id="danh-sach-dot-giam-gia" role="tabpanel"
                     aria-labelledby="danh-sach-dot-giam-gia-tab">
                    <table class="table table-hover">
                        <thead>
                        <tr>
                            <th>ID</th>
                            <th>Tên Đợt</th>
                            <th>Giá Trị Giảm</th>
                            <th>Ngày Bắt Đầu</th>
                            <th>Ngày Kết Thúc</th>
                            <th>Người Tạo</th>
                            <th>Ngày Tạo</th>
                            <th>Người Cập Nhật</th>
                            <th>Lần Cuối Cập Nhật</th>
                            <th>Trạng Thái</th>
                            <th colspan="3">Hành Động</th>
                        </tr>
                        </thead>
                        <tbody id="listDotGiamGia">

                        </tbody>
                    </table>
                </div>

                <div class="tab-pane fade" id="chinh-sua-dot-giam-gia" role="tabpanel"
                     aria-labelledby="chinh-sua-dot-giam-gia-tab">
                    <form id="formDotGiamGia">
                        <div class="form-group">
                            <label for="id">ID</label>
                            <input type="text" class="form-control" id="id" name="id" placeholder="Nhập ID" required
                                   disabled>
                        </div>
                        <div class="form-group">
                            <label for="tenDot">Tên Đợt</label>
                            <input type="text" class="form-control" id="tenDot" name="tenDot"
                                   placeholder="Nhập tên đợt" required>
                        </div>
<!--                        <div class="form-group">-->
<!--                            <label for="giaTriGiam">Giá Trị Giảm</label>-->
<!--                            <input type="number" class="form-control" id="giaTriGiam" name="giaTriGiam"-->
<!--                                   placeholder="Nhập giá trị giảm" required>-->
<!--                        </div>-->
<!--                        <div class="form-group">-->
<!--                            <label for="ngayBatDau">Ngày Bắt Đầu</label>-->
<!--                            <input type="date" class="form-control" id="ngayBatDau" name="ngayBatDau"-->
<!--                                   placeholder="Nhập ngày bắt đầu" required>-->
<!--                        </div>-->
<!--                        <div class="form-group">-->
<!--                            <label for="ngayKetThuc">Ngày Kết Thúc</label>-->
<!--                            <input type="date" class="form-control" id="ngayKetThuc" name="ngayKetThuc"-->
<!--                                   placeholder="Nhập ngày kết thúc" required>-->
<!--                        </div>-->
<!--                        <div class="form-group">-->
<!--                            <label for="trangThai">Trạng thái</label>-->
<!--                            <select class="form-select" id="trangThai" name="trangThai" required>-->
<!--                                <option value="" disabled selected>Chọn trạng thái</option>-->
<!--                                <option value="1">Đang hoạt động</option>-->
<!--                                <option value="2">Không hoạt động</option>-->
<!--                                <option value="3">Sắp đến</option>-->
<!--                                <option value="4">Sắp kết thúc</option>-->
<!--                            </select>-->
<!--                        </div>-->
                        <button type="submit" class="btn btn-primary" id="btnThemDotGiamGia">Thêm</button>
                        <button type="submit" class="btn btn-success" id="btnSuaDotGiamGia">Lưu</button>
                        <button type="reset" class="btn btn-secondary">Reset</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Reports Section -->
        <div id="reports" class="content-section" style="display: none;">
            <h2>Reports</h2>
            <!-- Content for reports -->
        </div>
    </main>
</div>


<!-- 1. Nhúng thư viện bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- 2. Nhúng thư viện font icon -->
<script src="https://kit.fontawesome.com/41dd1b16b5.js"></script>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!--<script src="https://stackpath.bootstrapcdn.com/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>-->


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

<script>
    function showSection(sectionId) {
        document.querySelectorAll('.content-section').forEach(section => {
            section.style.display = 'none';
        });
        document.getElementById(sectionId).style.display = 'block';
    }


    document.addEventListener("DOMContentLoaded", function () {
        if (document.getElementById("manage-products")) {
            fetchProducts();
        }
    });

    // ahihi
    function fetchProducts() {
        fetch('/api/san-pham/hien-thi')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                const productsTableBody = document.querySelector("#productsTable tbody");
                productsTableBody.innerHTML = ""; // Clear existing rows

                data.forEach(product => {
                    const row = `
                    <tr>
                        <td>${product.id}</td>
                        <td>${product.tenSanPham}</td>

                    </tr>
                `;
                    productsTableBody.innerHTML += row;
                });
            })
            .catch(error => console.error('Error fetching products:', error));
    }


    document.addEventListener("DOMContentLoaded", function () {
        if (document.getElementById("manage-discounts")) {
            fetchProducts();
        }
    });


    function loadPhieuGiamTable() {
        fetch('/api/phieu-giam/hien-thi')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Không thể tải danh sách phiếu giảm');
                }
                return response.json();
            })
            .then(data => {
                const listPhieuGiam = document.getElementById("listPhieuGiam");
                listPhieuGiam.innerHTML = ""; // Xóa nội dung hiện tại

                data.forEach(phieuGiam => {
                    const newRow = document.createElement("tr");

                    newRow.innerHTML = `
                    <td>${phieuGiam.id}</td>
                    <td>${phieuGiam.maGiam}</td>
                    <td>${phieuGiam.giaTriGiamMax}</td>
                    <td>${phieuGiam.giaTriGiam}</td>
                    <td>${phieuGiam.soLuong}</td>
                    <td>${formatDate(phieuGiam.ngayBatDau)}</td>
                    <td>${formatDate(phieuGiam.ngayKetThuc)}</td>
                    <td>${phieuGiam.nguoiTao}</td>
                    <td>${formatDate(phieuGiam.ngayTao)}</td>
                    <td>${phieuGiam.nguoiCapNhat}</td>
                    <td>${formatDate(phieuGiam.lanCapNhatCuoi)}</td>
                    <td>${getTrangThaiText(phieuGiam.trangThai)}</td>
                    <td>
                        <button class="btn btn-warning btn-sua btn-sm" onclick="suaPhieuGiam(${phieuGiam.id})">Sửa</button>
                    </td>

                `;

                    listPhieuGiam.appendChild(newRow);
                });
            })
            .catch(error => {
                console.error('Lỗi:', error.message);
                alert('Đã xảy ra lỗi khi tải dữ liệu: ' + error.message);
            });
    }

    // Hàm để định dạng ngày
    function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString();
    }

    // Hàm lấy trạng thái dạng chữ
    function getTrangThaiText(status) {
        switch (status) {
            case 1:
                return 'Đang hoạt động';
            case 2:
                return 'Không hoạt động';
            case 3:
                return 'Sắp đến';
            case 4:
                return 'Sắp kết thúc';
            default:
                return 'Không xác định';
        }
    }

    // Tải bảng khi trang được tải
    document.addEventListener("DOMContentLoaded", loadPhieuGiamTable);

    async function addDiscountCoupon(event) {
        event.preventDefault(); // Ngăn chặn hành động gửi form mặc định

        const id = document.getElementById("id").value;
        const maGiam = document.getElementById("maGiam").value;
        const giaTriGiamMax = parseFloat(document.getElementById("giaTriGiamMax").value);
        const giaTriGiam = parseFloat(document.getElementById("giaTriGiam").value);
        const soLuong = parseInt(document.getElementById("soLuong").value);
        const ngayBatDau = document.getElementById("ngayBatDau").value;
        const ngayKetThuc = document.getElementById("ngayKetThuc").value;
        const trangThai = document.getElementById("trangThai").value;

        const discountData = {
            maGiam,
            giaTriGiamMax,
            giaTriGiam,
            soLuong,
            ngayBatDau,
            ngayKetThuc,
            trangThai
        };

        const method = id ? "PUT" : "POST";
        const url = id ? `/api/phieu-giam/sua/${id}` : '/api/phieu-giam/them';

        try {
            const response = await fetch(url, {
                method,
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(discountData)
            });

            if (response.ok) {
                alert(id ? "Phiếu giảm đã được cập nhật!" : "Phiếu giảm đã được thêm thành công!");
                resetForm();
                loadPhieuGiamTable();
                // Chuyển về tab "Danh Sách Phiếu Giảm" sau khi cập nhật thành công
                document.querySelector('#danh-sach-phieu-giam-tab').click();
            } else {
                const errorData = await response.json();
                alert("Thao tác thất bại: " + errorData.message);
            }
        } catch (error) {
            console.error("Lỗi:", error);
            alert("Đã xảy ra lỗi khi xử lý phiếu giảm.");
        }
    }
    function suaPhieuGiam(id) {
        // Chuyển sang tab chỉnh sửa
        document.querySelector('#chinh-sua-phieu-giam-tab').click();

        // Gọi API để lấy dữ liệu của phiếu giảm với ID cụ thể
        fetch(`/api/phieu-giam/${id}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error("Không thể tải phiếu giảm");
                }
                return response.json();
            })
            .then(phieuGiam => {
                // Đẩy dữ liệu lên form
                document.getElementById("id").value = phieuGiam.id;
                document.getElementById("maGiam").value = phieuGiam.maGiam;
                document.getElementById("giaTriGiamMax").value = phieuGiam.giaTriGiamMax;
                document.getElementById("giaTriGiam").value = phieuGiam.giaTriGiam;
                document.getElementById("soLuong").value = phieuGiam.soLuong;
                document.getElementById("ngayBatDau").value = phieuGiam.ngayBatDau;
                document.getElementById("ngayKetThuc").value = phieuGiam.ngayKetThuc;
                document.getElementById("trangThai").value = phieuGiam.trangThai;
            })
            .catch(error => {
                console.error("Lỗi:", error);
                alert("Đã xảy ra lỗi khi tải dữ liệu phiếu giảm.");
            });
    }

    // Hàm để reset các trường trong form
    function resetForm() {
        document.getElementById("maGiam").value = "";
        document.getElementById("giaTriGiamMax").value = "";
        document.getElementById("giaTriGiam").value = "";
        document.getElementById("soLuong").value = "";
        document.getElementById("ngayBatDau").value = "";
        document.getElementById("ngayKetThuc").value = "";
        document.getElementById("trangThai").value = ""; // Reset về mặc định hoặc một tùy chọn cụ thể
    }

    // Thêm lắng nghe sự kiện cho việc gửi form
    document.getElementById("yourFormId").addEventListener("submit", addDiscountCoupon);











    function loadDotGiamGiaTable() {
        fetch('/api/dot-giam-gia/hien-thi')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Không thể tải danh sách đợt giảm giá');
                }
                return response.json();
            })
            .then(data => {
                const listDotGiamGia = document.getElementById("listDotGiamGia");
                listDotGiamGia.innerHTML = ""; // Xóa nội dung hiện tại

                data.forEach(dotGiamGia => {
                    const newRow = document.createElement("tr");

                    newRow.innerHTML = `
                    <td>${dotGiamGia.id}</td>
                    <td>${dotGiamGia.tenDot}</td>
                    <td>${dotGiamGia.giaTriGiam}</td>
                    <td>${formatDate(dotGiamGia.ngayBatDau)}</td>
                    <td>${formatDate(dotGiamGia.ngayKetThuc)}</td>
                    <td>${dotGiamGia.nguoiTao}</td>
                    <td>${formatDate(dotGiamGia.ngayTao)}</td>
                    <td>${dotGiamGia.nguoiCapNhat}</td>
                    <td>${formatDate(dotGiamGia.lanCapNhatCuoi)}</td>
                    <td>${getTrangThaiText(dotGiamGia.trangThai)}</td>
                    <td>
                        <button class="btn btn-warning btn-sua btn-sm" onclick="suaDotGiamGia(${dotGiamGia.id})">Sửa</button>
                    </td>

                `;

                    listDotGiamGia.appendChild(newRow);
                });
            })
            .catch(error => {
                console.error('Lỗi:', error.message);
                alert('Đã xảy ra lỗi khi tải dữ liệu: ' + error.message);
            });
    }

    // // Hàm để định dạng ngày
    // function formatDate(dateString) {
    //     const date = new Date(dateString);
    //     return date.toLocaleDateString();
    // }
    //
    // // Hàm lấy trạng thái dạng chữ
    // function getTrangThaiText(status) {
    //     switch (status) {
    //         case 1:
    //             return 'Đang hoạt động';
    //         case 2:
    //             return 'Không hoạt động';
    //         case 3:
    //             return 'Sắp đến';
    //         case 4:
    //             return 'Sắp kết thúc';
    //         default:
    //             return 'Không xác định';
    //     }
    // }

    function resetFormDot() {
        document.getElementById("tenDot").value = "";
        document.getElementById("giaTriGiam").value = "";
        document.getElementById("ngayBatDau").value = "";
        document.getElementById("ngayKetThuc").value = "";
        document.getElementById("trangThai").value = "";
    }

    // Tải bảng khi trang được tải
    document.addEventListener("DOMContentLoaded", loadDotGiamGiaTable);

    async function themDotGiamGia(event) {
        event.preventDefault();

        const id = document.getElementById("id").value;
        const tenDot = document.getElementById("tenDot").value;
        const giaTriGiam = parseFloat(document.getElementById("giaTriGiam").value);
        const ngayBatDau = document.getElementById("ngayBatDau").value;
        const ngayKetThuc = document.getElementById("ngayKetThuc").value;
        const trangThai = document.getElementById("trangThai").value;


        const dotGiamGiaData = {
            tenDot,
            giaTriGiam,
            ngayBatDau,
            ngayKetThuc,
            trangThai
        };

        const method = id ? "PUT" : "POST";
        const url = id ? `/api/dot-giam-gia/sua/${id}` : '/api/dot-giam-gia/them';

        try {
            const response = await fetch(url, {
                method,
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(dotGiamGiaData)
            });

            if (response.ok) {
                alert(id ? "Đợt giảm giá đã được cập nhật!" : "Đợt giảm giá đã được thêm thành công!");
                resetFormDot();
                loadDotGiamGiaTable();
                document.querySelector('#danh-sach-dot-giam-gia-tab').click();
            } else {
                try {
                    const errorData = await response.json();
                    alert("Thao tác thất bại: " + errorData.message);
                } catch {
                    alert("Thao tác thất bại: Không thể đọc lỗi từ phản hồi máy chủ.");
                }
            }
        } catch (error) {
            console.error("Lỗi:", error);
            alert("Đã xảy ra lỗi khi xử lý đợt giảm giá.");
        }
    }

    function suaDotGiamGia(id) {
        // Chuyển sang tab chỉnh sửa
        document.querySelector('#chinh-sua-dot-giam-gia-tab').click();

        // Gọi API để lấy dữ liệu của đợt giảm giá với ID cụ thể
        fetch(`/api/dot-giam-gia/${id}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error("Không thể tải đợt giảm giá");
                }
                return response.json();
            })
            .then(dotGiamGia => {
                // Đẩy dữ liệu lên form
                document.getElementById("id").value = dotGiamGia.id;
                document.getElementById("tenDot").value = dotGiamGia.tenDot;
                document.getElementById("giaTriGiam").value = dotGiamGia.giaTriGiam;
                document.getElementById("ngayBatDau").value = dotGiamGia.ngayBatDau;
                document.getElementById("ngayKetThuc").value = dotGiamGia.ngayKetThuc;
                document.getElementById("trangThai").value = dotGiamGia.trangThai;
            })
            .catch(error => {
                console.error("Lỗi:", error);
                alert("Đã xảy ra lỗi khi tải dữ liệu đợt giảm giá.");
            });
    }

    // Thêm lắng nghe sự kiện cho việc gửi form
    document.getElementById("formDotGiamGia").addEventListener("submit", themDotGiamGia);

</script>
</body>
</html>
